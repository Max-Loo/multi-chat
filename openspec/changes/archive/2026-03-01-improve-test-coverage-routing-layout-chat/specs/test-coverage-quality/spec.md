## ADDED Requirements

### Requirement: 测试覆盖率标准定义

系统必须定义清晰的测试覆盖率标准，为不同模块设定最低覆盖率目标，确保代码质量和系统稳定性。

#### Scenario: 查看测试覆盖率标准
- **WHEN** 开发者查看项目测试规范
- **THEN** 系统应提供明确的模块覆盖率目标：
  - router 模块：最低 80% 覆盖率
  - Layout 组件：最低 70% 覆盖率
  - ChatContent/components 组件群：最低 80% 覆盖率

#### Scenario: 验证覆盖率目标设定依据
- **WHEN** 查看覆盖率目标设定说明
- **THEN** 系统应提供以下依据：
  - Router：高覆盖率目标（80%），因为路由逻辑复杂但相对稳定
  - Layout：中等覆盖率目标（70%），因为涉及大量 UI 渲染和第三方库
  - ChatContent/components：高覆盖率目标（80%），因为业务逻辑清晰，交互可测试性强

### Requirement: 测试类型分类规范

系统必须定义清晰的测试类型分类，指导开发者编写合适的测试。

#### Scenario: 查看测试类型定义
- **WHEN** 开发者查看测试类型规范
- **THEN** 系统应提供以下测试类型分类：
  - **单元测试**：测试独立函数和类的方法，聚焦于输入输出和边界条件
  - **组件测试**：测试 React 组件的渲染和用户交互行为
  - **集成测试**：测试多个模块协作完成的功能流程

#### Scenario: 确定测试类型选择标准
- **WHEN** 开发者为特定模块编写测试
- **THEN** 系统应提供以下指导：
  - 工具函数和纯逻辑：优先使用单元测试
  - React 组件：使用组件测试，测试用户可见行为
  - 跨模块流程：使用集成测试验证关键路径

### Requirement: 测试编写规范

系统必须定义测试编写规范，确保测试代码的可维护性和有效性。

#### Scenario: 测试文件组织规范
- **WHEN** 开发者创建测试文件
- **THEN** 系统应遵循以下组织规范：
  - 核心模块测试（router、Layout）放置在 `src/__test__/` 目录
  - 组件测试就近放置在源文件同目录或 `__tests__` 目录
  - 测试数据 fixtures 放置在 `src/__test__/fixtures/` 目录

#### Scenario: 测试命名规范
- **WHEN** 开发者编写测试用例
- **THEN** 测试命名应符合以下规范：
  - 使用描述性名称，清楚说明测试的场景和预期结果
  - 格式："should [expected behavior] when [condition]"
  - 示例："should navigate to chat page when chat ID is valid"

#### Scenario: Mock 使用规范
- **WHEN** 开发者在测试中使用 Mock
- **THEN** 应遵循以下原则：
  - 单元测试：Mock 所有外部依赖（API、文件系统、时间）
  - 组件测试：Mock API 请求（使用 MSW），避免 Mock 实现细节
  - 集成测试：仅 Mock 外部服务，保持内部模块真实交互

### Requirement: 测试工具要求

系统必须使用现有的测试工具框架，避免引入额外依赖。

#### Scenario: 验证测试工具栈
- **WHEN** 开发者查看项目测试工具
- **THEN** 系统应使用以下工具：
  - **Vitest**：测试运行器和断言库
  - **React Testing Library**：React 组件测试工具
  - **MSW (Mock Service Worker)**：API 请求模拟
  - **@testing-library/user-event**：用户交互模拟

#### Scenario: 确认测试工具配置
- **WHEN** 开发者运行测试
- **THEN** 测试工具应正确配置：
  - Vitest 配置文件：`vite.config.ts` 中的 `test` 字段
  - React Testing Library 配置：测试设置文件中的全局配置
  - MSW 配置：测试文件中的 handlers 设置

### Requirement: 覆盖率监控和报告

系统必须提供覆盖率报告功能，帮助开发者识别未测试的代码区域。

#### Scenario: 生成覆盖率报告
- **WHEN** 开发者运行测试命令（带覆盖率参数）
- **THEN** 系统应生成以下报告：
  - 终端输出的覆盖率摘要
  - HTML 格式的详细覆盖率报告（存储在 `coverage/` 目录）
  - 各模块的覆盖率统计（行覆盖率、分支覆盖率、函数覆盖率）

#### Scenario: 验证覆盖率目标达成
- **WHEN** 开发者查看覆盖率报告
- **THEN** 系统应高亮显示：
  - 未达标的模块（红色标记）
  - 已达标的模块（绿色标记）
  - 未覆盖的代码行和分支

### Requirement: Router 模块测试规范

系统必须为 router 模块定义详细的测试规范，确保路由配置和导航逻辑的正确性。

#### Scenario: 测试路由配置结构
- **WHEN** 编写路由配置测试
- **THEN** 系统应验证：
  - 所有路由路径正确定义
  - 路由组件正确导入
  - 嵌套路由结构正确
  - 重定向规则正确配置

#### Scenario: 测试路由导航守卫
- **WHEN** 编写导航守卫测试
- **THEN** 系统应验证：
  - 守卫函数在正确的时机执行
  - 守卫逻辑正确处理权限验证
  - 守卫拦截无效导航请求
  - 守卫允许合法导航请求

#### Scenario: 测试路由参数解析
- **WHEN** 编写路由参数测试
- **THEN** 系统应验证：
  - 路径参数正确解析（如 `/chat/:id` 中的 `id`）
  - 查询参数正确解析
  - 参数验证逻辑正确处理无效参数

### Requirement: Layout 组件测试规范

系统必须为 Layout 组件定义详细的测试规范，确保布局渲染和响应式行为的正确性。

#### Scenario: 测试布局渲染
- **WHEN** 编写 Layout 渲染测试
- **THEN** 系统应验证：
  - 布局组件正确渲染
  - 子组件正确显示在预期位置
  - 布局结构符合设计规范

#### Scenario: 测试响应式行为
- **WHEN** 编写响应式布局测试
- **THEN** 系统应验证：
  - 不同屏幕尺寸下布局正确调整
  - 移动端和桌面端布局差异符合预期
  - 断点切换时布局平滑过渡

#### Scenario: 测试布局交互
- **WHEN** 编写布局交互测试
- **THEN** 系统应验证：
  - 侧边栏展开/收起功能正常
  - 用户操作触发正确的布局状态变化
  - 布局状态在组件间正确传递

### Requirement: ChatContent/components 组件群测试规范

系统必须为聊天内容组件群定义详细的测试规范，确保消息渲染和交互功能的正确性。

#### Scenario: 测试消息渲染
- **WHEN** 编写消息组件渲染测试
- **THEN** 系统应验证：
  - 文本消息正确显示
  - 用户消息和助手消息样式区分明显
  - 消息时间戳正确显示
  - 长消息正确换行和截断

#### Scenario: 测试 Markdown 解析
- **WHEN** 编写 Markdown 渲染测试
- **THEN** 系统应验证：
  - 标题（#）正确渲染
  - 代码块（```）正确解析和高亮
  - 列表（无序和有序）正确显示
  - 链接和图片正确渲染
  - 特殊字符正确转义

#### Scenario: 测试代码块高亮
- **WHEN** 编写代码高亮测试
- **THEN** 系统应验证：
  - 不同编程语言的代码块正确高亮
  - 代码块包含行号（如果启用）
  - 代码块支持复制功能
  - 长代码块正确滚动

#### Scenario: 测试用户交互行为
- **WHEN** 编写交互测试
- **THEN** 系统应验证：
  - 消息复制功能正常
  - 代码块复制功能正常
  - 消息重新生成功能正常
  - 消息编辑功能正常
  - 快捷键操作正确触发

### Requirement: 测试数据管理规范

系统必须定义测试数据管理规范，确保测试数据的可复用性和一致性。

#### Scenario: 创建测试 fixtures
- **WHEN** 开发者需要测试数据
- **THEN** 应使用以下方式：
  - 在 `src/__test__/fixtures/` 目录创建 fixture 文件
  - 导出常用的测试数据对象
  - 使用辅助函数生成动态测试数据

#### Scenario: 复用测试辅助工具
- **WHEN** 开发者编写测试
- **THEN** 应优先使用现有的辅助工具：
  - `src/__test__/helpers/` 目录中的测试辅助函数
  - 避免在每个测试中重复构建相同的数据结构
  - 保持测试代码简洁和可维护

### Requirement: CI/CD 集成要求

系统必须定义测试在 CI/CD 流程中的集成要求，确保代码质量门禁。

#### Scenario: CI 流程中的测试执行
- **WHEN** 代码提交到仓库
- **THEN** CI 流程应自动：
  - 运行所有测试用例
  - 生成覆盖率报告
  - 将测试结果反馈给开发者
  - 阻止测试失败的代码合并

#### Scenario: 覆盖率报告上传
- **WHEN** CI 流程完成测试
- **THEN** 系统应：
  - 上传覆盖率报告到代码覆盖率平台（如 Codecov、Coveralls）
  - 在 Pull Request 中显示覆盖率变化
  - 提供详细的覆盖率差异分析