## 1. 测试环境设置

- [x] 1.1 创建测试文件 `src/store/storage/modelStorage.test.ts`
- [x] 1.2 配置 Vitest Mock 模块（`@/utils/crypto`、`@/store/keyring/masterKey`、`./storeUtils`）
- [x] 1.3 创建测试辅助函数（`createMockModel()`）
- [x] 1.4 设置测试套件基本结构（`describe()` 嵌套）

## 2. 加密函数测试

- [x] 2.1 测试成功加密 API 密钥（返回 "enc:" 前缀）
- [x] 2.2 测试跳过已加密的 API 密钥（不重复加密）
- [x] 2.3 测试处理空 API 密钥（不执行加密）
- [x] 2.4 测试加密失败时抛出错误（记录日志 + 包含模型信息的错误对象）

## 3. 解密函数测试

- [x] 3.1 测试成功解密 API 密钥（返回明文）
- [x] 3.2 测试跳过明文 API 密钥（保持不变）
- [x] 3.3 测试解密失败时返回空字符串（记录日志）

## 4. 保存函数测试

- [x] 4.1 测试成功保存模型列表（加密敏感字段 + 调用 `saveToStore()`）
- [x] 4.2 测试主密钥不存在时抛出错误（"主密钥不存在，无法保存敏感数据"）
- [x] 4.3 测试批量加密所有模型（使用 `Promise.all()`）

## 5. 加载函数测试

- [x] 5.1 测试成功加载并解密模型列表（返回完整模型）
- [x] 5.2 测试空模型列表时返回空数组
- [x] 5.3 测试主密钥不存在时返回部分解密的模型（加密密钥 → 空字符串，明文密钥 → 原值）
- [x] 5.4 测试部分模型解密失败时继续处理（失败模型的 `apiKey` → 空字符串）

## 6. 边界情况和错误处理测试

- [x] 6.1 测试处理不完整的模型对象（缺少可选字段，不抛出错误）
- [x] 6.2 测试并发保存操作（多次调用 `saveModelsToJson()`，不丢失数据）
- [x] 6.3 测试加密/解密性能（100+ 模型，标记为 `test.slow()`）

## 7. CI/CD 集成和验证

- [x] 7.1 运行测试套件（`pnpm test modelStorage`），确保所有测试通过
- [x] 7.2 生成覆盖率报告（`pnpm test:coverage`），验证覆盖率 > 90%
- [x] 7.3 确认 CI 测试包含新测试（`pnpm test:run`）
- [x] 7.4 运行完整测试套件（`pnpm test:run`），确保无回归
- [x] 7.5 代码审查和清理（移除调试代码、优化测试可读性）
