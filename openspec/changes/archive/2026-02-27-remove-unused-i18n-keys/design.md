## Context

当前项目使用 i18next 进行国际化管理，包含 7 个语言文件（英文和中文各 7 个）：`common.json`、`chat.json`、`model.json`、`navigation.json`、`provider.json`、`setting.json`、`table.json`。随着项目迭代，部分翻译 key 可能已经不再被使用，但仍保留在配置文件中。

项目已配置 `knip` 工具用于检测未使用的代码（包括文件、依赖、导出、类型），但需要确认其是否能够检测未使用的 i18n keys。

## Goals / Non-Goals

**Goals:**
- 自动识别所有未使用的国际化翻译 key
- 从英文和中文语言文件中安全移除未使用的 key
- 确保移除后类型定义与实际使用的 key 保持一致
- 验证应用功能不受影响（所有翻译仍然正常显示）

**Non-Goals:**
- 修改翻译内容的格式或结构
- 重新组织语言文件的命名空间
- 优化翻译内容本身（如翻译质量）
- 处理动态构建的 key（将通过人工审核排除）

## Decisions

### 1. 使用自定义脚本进行未使用 key 检测

**决策**: 编写自定义脚本 `scripts/detect-unused-i18n-keys.mjs` 检测未使用的 i18n keys。

**理由**:
- 项目的 i18n 使用类型安全的调用方式 `t($ => $.namespace.key)`，而非传统的 `t('namespace.key')` 格式
- knip 工具基于静态分析和字符串匹配，无法解析 TypeScript 类型安全的函数调用
- 自定义脚本可以精确提取 `t($ => $.)` 模式中的 key 路径
- 脚本输出结构化的 JSON 报告，便于后续处理

**替代方案**:
- 使用 knip：经测试，knip 无法检测此类调用模式（已验证）
- 使用 i18n-ally 插件：需要额外配置，增加复杂度

### 2. 分阶段检测与移除

**决策**: 采用"先检测、后审核、再移除"的三阶段流程。

**理由**:
- 第一阶段：工具扫描生成未使用 key 的候选列表
- 第二阶段：人工审核排除动态使用的 key（如字符串拼接）
- 第三阶段：执行移除并验证

**替代方案**:
- 完全自动移除：风险过高，可能误删动态使用的 key
- 完全手动：效率低，容易遗漏

### 3. 类型安全验证

**决策**: 移除 key 后运行类型检查（`pnpm tsc`）确保类型定义一致。

**理由**:
- 项目的 i18n 系统有 TypeScript 类型定义（`src/types/i18n.d.ts`）
- 类型检查可以捕获 key 移除不匹配的问题
- 确保编译时的类型安全

### 4. 验证应用功能

**决策**: 移除后启动应用并手动检查所有页面的翻译显示。

**理由**:
- 工具可能无法检测所有运行时动态使用的 key
- 人工验证确保用户体验不受影响
- 可配合截图测试记录移除前后对比

## Risks / Trade-offs

### 风险 1：动态使用的 key 被误判为未使用

**描述**: 代码中可能通过字符串拼接动态构建 key（如 `t(\`${prefix}.${key}\`)`），静态分析工具无法识别。

**缓解措施**:
- 人工审核未使用 key 列表，排除明显的动态使用模式
- 使用 grep 搜索 key 的字符串形式（不限于 `t()` 调用）
- 保留可能动态使用的 key（如包含变量插值的命名空间）

### 风险 2：类型定义不同步

**描述**: 移除 JSON 文件中的 key 后，TypeScript 类型定义可能未同步更新，导致类型错误。

**缓解措施**:
- 如果类型定义是自动生成的（通过工具），重新生成类型定义
- 如果类型定义是手动的，同步更新 `src/types/i18n.d.ts`
- 运行 `pnpm tsc` 验证类型正确性

### 风险 3：第三方库依赖的 key

**描述**: 某些 key 可能被第三方库或外部工具使用（如测试、文档生成），静态分析无法覆盖。

**缓解措施**:
- 检查配置文件中是否有引用 i18n keys 的工具
- 运行完整的测试套件（`pnpm test`）确保测试通过
- 如果不确定，保守保留该 key

## Migration Plan

### 阶段 1：检测未使用的 keys
1. 运行 knip 工具检测未使用的 i18n keys
2. 收集所有候选的未使用 key 列表
3. 按语言文件分组输出报告

### 阶段 2：人工审核
1. 审查每个候选 key，确认是否真的未使用
2. 使用 grep 搜索 key 的所有出现（包括字符串形式）
3. 排除动态使用的 key 和可能被第三方工具使用的 key
4. 生成最终确认的待移除 key 列表

### 阶段 3：执行移除
1. 从英文语言文件（`src/locales/en/*.json`）中移除确认的 key
2. 从中文语言文件（`src/locales/zh/*.json`）中移除对应的 key
3. 更新 TypeScript 类型定义（如需要）
4. 运行 `pnpm tsc` 验证类型正确性

### 阶段 4：验证
1. 启动应用（`pnpm tauri dev`）
2. 遍历所有页面检查翻译显示正常
3. 运行测试套件（`pnpm test`）
4. 如发现问题，恢复被误删的 key

### 回滚策略
- 如果移除后发现问题，可从 git 历史中恢复被删除的 key
- 建议在单独的分支进行此工作，验证通过后再合并

## Open Questions

1. **knip 是否原生支持检测未使用的 i18n keys？**
   - 需要验证 knip 的配置选项
   - 如不支持，可能需要编写自定义脚本或配置 knip 的插件系统

2. **类型定义是如何生成的？**
   - 检查 `src/types/i18n.d.ts` 是手动的还是自动生成的
   - 如果是自动生成的，需要了解重新生成命令
   - 如果是手动的，需要同步更新所有相关类型

3. **是否有其他工具或脚本依赖 i18n keys？**
   - 检查是否有文档生成工具、测试工具等使用翻译 key
   - 确保移除 key 不会破坏这些工具
